function getAndSetFromCookie(a,b){for(var c=0;c<a.length;c++){for(var d=a[c];" "==d.charAt(0);)d=d.substring(1);var e=b+"=";if(0==d.indexOf(e))return d.substring(e.length,d.length)}return""}function setCookie(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toUTCString(),f=a+"="+b+"; "+e;document.cookie=f}function generateComments(){totalScore=0,$.each($(".assignedPoints"),function(a,b){""!=b.value&&"-"!=b.value?(totalScore+=parseFloat(b.value),arrayOfScores[a]=parseFloat(b.value)):arrayOfScores[a]=0}),$("#latePoints").is(":checked")&&(console.log("Pts"),totalScore-=parseFloat($("#latePoints").attr("data-penalty"))),maxPoints=0;for(var a in arrayOfMaxPoints)maxPoints+=parseFloat(arrayOfMaxPoints[a]);$("#totalPossiblePts").html(maxPoints),$("#totalCalcPts").html(totalScore),$.each($(".taComments"),function(a,b){var c=b.value;for(arrayOfCommentsText[a]=c;c.indexOf("\n")>-1;)c=c.replace("\n","<br>");arrayOfComments[a]=c});var b="",c="";if($.each(arrayOfCategories,function(a,d){b=b+d+": "+arrayOfScores[a]+"/"+arrayOfMaxPoints[a]+"<br>",c=c+d+": "+arrayOfScores[a]+"/"+arrayOfMaxPoints[a]+"\n",""!=arrayOfComments[a]&&(b=b+arrayOfComments[a]+"<br><br>",c=c+arrayOfCommentsText[a]+"\n\n")}),""!=$("#generalComment").val()){var d="";""!=$("#generalPoints").val()&&0!=$("#generalPoints").val()&&(d=$("#generalPoints").val()>0?"(+"+$("#generalPoints").val()+")":"("+$("#generalPoints").val()+")"),b=b+"<br>"+d+" "+$("#generalComment").val()+"<br>",c=c+"\n"+d+" "+$("#generalComment").val()+"\n"}$("#latePoints").is(":checked")&&(console.log("Yeah"),b=b+"<br>(-"+$("#latePoints").data("penalty")+") - Late Penalty. "+$("#lateComment").val()+"<br>",c=c+"\n(-"+$("#latePoints").data("penalty")+") "+$("#lateComment").val()+"\n"),b=b+"<br>Total Score: "+totalScore+"/"+maxPoints+"<br><br>",c=c+"\nTotal Score: "+totalScore+"/"+maxPoints+"\n\n",b=b+"Graded by "+taName+" ("+taEmail+").<br>"+taMessage,c=c+"Graded by "+taName+" ("+taEmail+").\n"+taMessage,$("#combinedComments").html(b),$("#copyCombinedComments").html(c)}function copyToClipboard(a){var d,e,b="_hiddenCopyText_",c="INPUT"===a.tagName||"TEXTAREA"===a.tagName;if(c)f=a,d=a.selectionStart,e=a.selectionEnd;else{if(f=document.getElementById(b),!f){var f=document.createElement("textarea");f.style.position="absolute",f.style.left="-9999px",f.style.top="0",f.id=b,document.body.appendChild(f)}f.textContent=a.textContent}var g=document.activeElement;f.focus(),f.setSelectionRange(0,f.value.length);var h;try{h=document.execCommand("copy")}catch(i){h=!1}return g&&"function"==typeof g.focus&&g.focus(),c?a.setSelectionRange(d,e):f.textContent="",h}function clearCategoryBox(){$("#newCatName").val(""),$("#newPointValue").val(""),$("#newGraderNotes").val("")}function generateCategories(){$("#categoryArea").html(""),$.each(arrayOfCategories,function(a,b){var c=$("#sampleCatRow").html();$template=$(c),$(".catTitle",$template).html(b),$(".maxPts",$template).html(arrayOfMaxPoints[a]),$(".assignedPoints",$template).attr("data-max",arrayOfMaxPoints[a]),$(".graderNotes",$template).html(arrayOfNotes[a]),$("#categoryArea").append($template.html())});var a=$("#generalRow").html();$template=$(a),$("#categoryArea").append($template.html());var a=$("#latePenalty").html();$template=$(a),$("#categoryArea").append($template.html()),$("#rubricNameTitle").html(rubricName),$.material.init(),$(".overPts").hide(),$("#main-area").removeClass("hidden"),$("#latePoints").on("click",function(){generateComments()})}function generateCategoriesEdit(){$("#categoryArea").html(""),$.each(arrayOfCategories,function(a,b){var c=$("#sampleCatRowEdit").html();$template=$(c),$(".catTitle",$template).html(b),$(".maxPts",$template).html(arrayOfMaxPoints[a]),$(".graderNotes",$template).html(arrayOfNotes[a]),$(".btnOpenEdit",$template).attr("data-index",a),$(".btnCatDel",$template).attr("data-index",a),$(".btnCatCpy",$template).attr("data-index",a),$("#categoryArea").append($template.html())});var a=$("#generalRow").html();$template=$(a),$("#categoryArea").append($template.html());var a=$("#latePenalty").html();$template=$(a),$("#categoryArea").append($template.html()),$("#rubricNameTitle").html(rubricName),$.material.init(),$('[data-toggle="tooltip"]').tooltip(),$("#main-area").removeClass("hidden")}function generateAvailableRubrics(){var a=$("#ddCreatedRubrics");a.html(""),a.append("<option>Select a rubric...</option>");for(var b in namesOfRubrics)a.append("<option>"+namesOfRubrics[b]+"</option>")}function getRubricsOnline(){ws.search('[type = "rubric"]',{sort:"name"},{applevel:!1}).on("success",function(a,b){namesOfRubrics=new Array,arrayOfCreatedRubrics=new Array;for(var c in a){keysOfObjects.push(c);var d=a[c],e=new Array;for(var f in d)if("name"==f)namesOfRubrics.push(d.name);else if("categories"==f){for(var g=new Array,h=0;h<d.categories.length;h++)g.push(d.categories[h]);e.push(g)}else"class"==f&&(rubricClass=d["class"],console.log(rubricClass));arrayOfCreatedRubrics.push(e)}generateAvailableRubrics()})}function getRubricsOnline(a){ws.search('[type = "rubric", class = "'+a+'"]',{sort:"name"},{applevel:!1}).on("success",function(a,b){namesOfRubrics=new Array,arrayOfCreatedRubrics=new Array;for(var c in a){keysOfObjects.push(c);var d=a[c],e=new Array;for(var f in d)if("name"==f)namesOfRubrics.push(d.name);else if("categories"==f){for(var g=new Array,h=0;h<d.categories.length;h++)g.push(d.categories[h]);e.push(g)}else"class"==f&&(rubricClass=d["class"],console.log(rubricClass));arrayOfCreatedRubrics.push(e)}generateAvailableRubrics()})}function openEditDialog(){$("#editCatName").val(arrayOfCategories[indexForEdit]),$("#editPointValue").val(arrayOfMaxPoints[indexForEdit]),$("#editGraderNotes").val(arrayOfNotes[indexForEdit]),$("#edit-category-dialog").modal("show")}function clearArrays(){arrayOfScores=new Array,arrayOfMaxPoints=new Array,arrayOfCategories=new Array,arrayOfComments=new Array,arrayOfNotes=new Array}function saveRubric(){var a=new Array;for(var b in arrayOfCategories){var c=new Array;c.push(arrayOfCategories[b]),c.push(arrayOfMaxPoints[b]),c.push(arrayOfNotes[b]),a.push(c)}ws.set(key,{type:"rubric",name:rubricName,categories:a,"class":rubricClass}).on("success",function(a,b){for(var c in a)key=c}).on("error",function(a,b){console.log(a)}).on("complete",function(a,b){})}$.material.init(),$("#fabCreateCat").hide(),$("#loginError").hide(),$("#resetEmailSent").hide(),$("#noRubricSelect").hide(),$("#graderHeader").hide(),$("#login-to-taa").modal("show");var totalScore=0,arrayOfScores=new Array,arrayOfMaxPoints=new Array,arrayOfCategories=new Array,arrayOfComments=new Array,arrayOfNotes=new Array,arrayOfCommentsText=new Array,rubricName="",maxPoints=0,generalPoints=0,key=null,rubricClass="",taName="",taEmail="",taMessage="",cookieName="taName",cookieEmail="taEmail",cookieGraderNote="taNote",cookies=document.cookie.split(";"),values="",indexForEdit=-1,indexOfMainDD=0;taName=getAndSetFromCookie(cookies,cookieName),taEmail=getAndSetFromCookie(cookies,cookieEmail),taMessage=getAndSetFromCookie(cookies,cookieGraderNote),$("#btnCreate").click(function(){$("#first-load-dialog").modal("hide"),$("#create-new-rubric-dialog").modal("show"),key=null}),$("#latePoints").on("click",function(){generateComments()}),$("#btnRubricCreateCancel").click(function(){$("#create-new-rubric-dialog").modal("hide"),$("#first-load-dialog").modal("show"),$("#newRubricName").val("")}),$("#fabCreateCat").click(function(){$("#create-new-category-dialog").modal("show")}),$(function(){$('[data-toggle="tooltip"]').tooltip()}),$(".row").on("keyup",".assignedPoints",function(){$(this).val()>$(this).data("max")?($(this).parent().addClass("has-warning"),$(this).parent().next().show()):($(this).parent().removeClass("has-warning"),$(this).parent().next().hide()),generateComments()}),$("#btnAll100").click(function(){$.each($(".assignedPoints"),function(a,b){$(this).val(arrayOfMaxPoints[a]),$(this).parent().removeClass("has-warning"),$(this).parent().next().hide()}),$("#latePoints").attr("checked",!1),generateComments()}),$("#btnClearOnlyComments").click(function(){$.each($(".taComments"),function(a,b){$(this).val("")}),generateComments()}),$(".row").on("focusout",".taComments",function(){generateComments()}),$("#btnCopyRubric").click(function(){copyToClipboard(document.getElementById("copyCombinedComments"))}),$("#btnTAInfo").click(function(){$("#taName").val(taName),$("#taEmail").val(taEmail),$("#taMessage").val(taMessage),$("#previewTAName").html(taName),$("#previewTAEmail").html(taEmail),$("#previewTAMessage").html(taMessage),$("#edit-ta-info-dialog").modal("show")}),$("#taName").keyup(function(){$("#previewTAName").html($("#taName").val())}),$("#taEmail").keyup(function(){$("#previewTAEmail").html($("#taEmail").val())}),$("#taMessage").keyup(function(){$("#previewTAMessage").html($("#taMessage").val())}),$("#saveTAInfo").click(function(){taName=$("#taName").val(),taEmail=$("#taEmail").val(),taMessage=$("#taMessage").val(),setCookie(cookieName,taName,365),setCookie(cookieEmail,taEmail,365),setCookie(cookieGraderNote,taMessage,365),generateComments()}),$("#btnClearComments").click(function(){$(".assignedPoints").val(""),$(".taComments").val(""),$("#latePoints").attr("checked",!1),generateComments()}),$("#btnRubricCreate").click(function(){$("#first-load-dialog").modal("hide"),$("#fabCreateCat").show(),rubricName=$("#newRubricName").val(),rubricClass=$("#classID option:selected").text(),$("#create-new-category-dialog").modal("show")}),$("#classSearch").on("change",function(){console.log("stuff"),1!=$(this).selectedIndex&&(console.log($("#classSearch option:selected").text()),getRubricsOnline($("#classSearch option:selected").text()))}),$("#btnCreateCat").click(function(){arrayOfCategories.push($("#newCatName").val()),arrayOfMaxPoints.push($("#newPointValue").val()),arrayOfNotes.push($("#newGraderNotes").val()),$("#create-new-category-dialog").modal("hide"),saveRubric(),generateCategoriesEdit(),generateComments(),clearCategoryBox()}),$("#btnCancelCat").click(function(){$("#create-new-category-dialog").modal("hide"),clearCategoryBox()});var ws=null,ws2=null,appID1="";$.ajax({url:"js/info.php",type:"POST",data:{p:window.location.href},cache:!1,success:function(a){appID1=a}}),$.ajax({url:"js/blank.php",type:"POST",data:{p:window.location.href.length},cache:!1,success:function(a){ws2=new cloudmine.WebService({appid:appID1,apikey:a})}});var arrayOfCreatedRubrics=new Array,namesOfRubrics=new Array,keysOfObjects=new Array;$("#btnGradeRubric").click(function(){var a=$("#ddCreatedRubrics").prop("selectedIndex")-1;if(a>-1){indexOfMainDD=a,$("#noRubricSelect").hide(),rubricName=namesOfRubrics[a];for(var b in arrayOfCreatedRubrics[a]){var c=arrayOfCreatedRubrics[a][b];for(var d in c)arrayOfCategories.push(c[d][0]),arrayOfMaxPoints.push(parseFloat(c[d][1])),arrayOfNotes.push(c[d][2])}key=keysOfObjects[a],$("#graderHeader").show(),generateCategories(),generateComments(),$("#fabCreateCat").hide(),$("#first-load-dialog").modal("hide"),""==taName&&$("#edit-ta-info-dialog").modal("show")}else $("#noRubricSelect").show()}),$("#btnEditRubric").click(function(){var a=$("#ddCreatedRubrics").prop("selectedIndex")-1;if(a>-1){indexOfMainDD=a,$("#noRubricSelect").hide(),rubricName=namesOfRubrics[a];for(var b in arrayOfCreatedRubrics[a]){var c=arrayOfCreatedRubrics[a][b];for(var d in c)arrayOfCategories.push(c[d][0]),arrayOfMaxPoints.push(parseFloat(c[d][1])),arrayOfNotes.push(c[d][2])}key=keysOfObjects[a],$("#graderHeader").hide(),generateCategoriesEdit(),generateComments(),$("#fabCreateCat").show(),$("#first-load-dialog").modal("hide")}else $("#noRubricSelect").show()}),$("#btnSaveCat").click(function(){arrayOfCategories[indexForEdit]=$("#editCatName").val(),arrayOfMaxPoints[indexForEdit]=$("#editPointValue").val(),arrayOfNotes[indexForEdit]=$("#editGraderNotes").val(),saveRubric(),generateCategoriesEdit(),generateComments(),indexForEdit=-1,$("#edit-category-dialog").modal("hide")}),$("#btnCancelEditCat").click(function(){$("#edit-category-dialog").modal("hide")}),$(".row").on("click",".btnOpenEdit",function(){indexForEdit=$(this).attr("data-index"),openEditDialog()});var rowToDelete=-1;$(".row").on("click",".btnCatDel",function(){rowToDelete=$(this).attr("data-index"),$("#confirmCatDelete").modal("show")}),$("#deleteCatNow").click(function(){arrayOfScores.splice(rowToDelete,1),arrayOfMaxPoints.splice(rowToDelete,1),arrayOfCategories.splice(rowToDelete,1),arrayOfComments.splice(rowToDelete,1),arrayOfNotes.splice(rowToDelete,1),arrayOfCommentsText.splice(rowToDelete,1),generateCategoriesEdit(),generateComments(),saveRubric(),$("#confirmCatDelete").modal("hide")});var rowToCpy=-1;$(".row").on("click",".btnCatCpy",function(){rowToCpy=$(this).attr("data-index"),$("#copyDialog").modal("show")}),$("#copyBelow").click(function(){arrayOfScores.splice(rowToCpy,0,arrayOfScores[rowToCpy]),arrayOfMaxPoints.splice(rowToCpy,0,arrayOfMaxPoints[rowToCpy]),arrayOfCategories.splice(rowToCpy,0,arrayOfCategories[rowToCpy]),arrayOfComments.splice(rowToCpy,0,arrayOfComments[rowToCpy]),arrayOfNotes.splice(rowToCpy,0,arrayOfNotes[rowToCpy]),arrayOfCommentsText.splice(rowToCpy,0,arrayOfCommentsText[rowToCpy]),generateCategoriesEdit(),generateComments(),saveRubric(),rowToCpy=-1,$("#copyDialog").modal("hide")}),$("#copyToEnd").click(function(){var a=arrayOfScores.length;arrayOfScores.splice(a,0,arrayOfScores[rowToCpy]),arrayOfMaxPoints.splice(a,0,arrayOfMaxPoints[rowToCpy]),arrayOfCategories.splice(a,0,arrayOfCategories[rowToCpy]),arrayOfComments.splice(a,0,arrayOfComments[rowToCpy]),arrayOfNotes.splice(a,0,arrayOfNotes[rowToCpy]),arrayOfCommentsText.splice(a,0,arrayOfCommentsText[rowToCpy]),generateCategoriesEdit(),generateComments(),saveRubric(),$("#copyDialog").modal("hide")}),$("#btnHome").click(function(){$("#fabCreateCat").hide(),clearArrays(),getRubricsOnline(),$("#main-area").addClass("hidden"),$("#ddCreatedRubrics").prop("selectedIndex",indexOfMainDD),$("#first-load-dialog").modal("show")}),$("#dda").click(function(){var a=document.getElementById("ddCreatedRubrics"),b=document.createEvent("MouseEvents");b.initEvent("mousedown",!0,!0),a.dispatchEvent(b)}),$("#processLogin").click(function(){ws2.login({username:$("#username").val(),password:$("#pswd").val()}).on("success",function(a,b){$.ajax({url:"js/info.php",type:"POST",data:{p:window.location.href.length},cache:!1,success:function(a){ws=new cloudmine.WebService({appid:appID1,apikey:a}),$("#loginError").hide(),$("#login-to-taa").hide(),$("#first-load-dialog").modal("show")}})}).on("error",function(a,b){console.log(b),$("#loginError").show()})}),$("#pswdReset").click(function(){ws2.resetPassword($("#emailForReset").val()).on("success",function(){$("#resetEmailSent").show()}).on("error",function(a,b){console.log(b)})}),$("#pswdResetModalOpen").click(function(){$("#pswdResetModal").modal("show")});